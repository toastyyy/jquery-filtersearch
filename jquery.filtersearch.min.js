!function(r){r.fn.filtersearch=function(e){var t=(e.source||"ajax",e.url||"",e.data||[]),i=e.data||[],a=this,s=e.renderItem||r.fn.filtersearch.renderItem,l=e.sortColumns||[],n=e.sortContainer||"#jqfs-sort-columns",o=(e.sortMethod||r.fn.filtersearch.sortMethod,e.filterColumns||[]),f=e.filterContainer||"#jqfs-filter-columns",c=e.renderFilter||r.fn.filtersearch.renderFilter,h=e.pagination||0,p=(e.maxPagination||0,e.paginationContainer||"#jqfs-pagination"),v=1;this.renderResults=function(){if(h>0){for(var e=parseInt(i.length/h),t='<ul class="pagination">',l=1;e>=l;l++)t+=v==l?'<li data-page="'+l+'" class="active">'+l+"</li>":'<li data-page="'+l+'">'+l+"</li>";t+="</ul>",r(p).html(t),r("ul.pagination>li[data-page]").click(function(){v=r(this).data("page"),u()})}var n="";if(h>0)for(var l=(v-1)*h;l<=Math.min(v*h-1,i.length);l++)n+=s(i[l]);else for(var l=0;l<=i.length;l++)n+=s(i[l]);a.html(n)};var u=this.renderResults;this.sorting=function(){i.sort(r.fn.filtersearch.sortMethod(r(this).data("property"))),r(this).hasClass("asc")?(r(n+" li").removeClass("asc"),r(n+" li").removeClass("desc"),r(this).addClass("desc"),i.reverse()):r(this).hasClass("desc")?(r(n+" li").removeClass("asc"),r(n+" li").removeClass("desc"),r(this).addClass("asc")):(r(n+" li").removeClass("asc"),r(n+" li").removeClass("desc"),r(this).addClass("asc")),u()};var d=this.sorting;this.renderSortContainer=function(){var e=r("<ul>");e.addClass("jqfs-sort"),r(n).html(e);for(var t in l){var i=r("<li>");i.data("property",l[t].property),i.text(l[t].label||l[t].property),i.appendTo(e),i.on("click",d)}};var g=this.renderSortContainer;this.renderFilterContainer=function(){var e={};for(var a in o){filter=o[a],e[filter.property]={label:filter.label,logic:filter.logic,characteristics:{}};for(var s in t){var l=t[s];if(filter.property in l){var n=l[filter.property];if("string"==typeof n)n in e[filter.property].characteristics?e[filter.property].characteristics[n]++:e[filter.property].characteristics[n]=1;else if("object"==typeof n)for(var h in n)n[h]in e[filter.property].characteristics?e[filter.property].characteristics[n[h]]++:e[filter.property].characteristics[n[h]]=1}}}var p=c(e),d={};r(f).html(p),r("[data-filter-property]").each(function(){var a=r(this).data("filter-property");r(this).children("[data-filter-value]").each(function(){r(this).click(function(){if(r(this).toggleClass("active"),r(this).hasClass("active"))a in d?d[a].values.push(r(this).data("filter-value")):d[a]={logic:e[a].logic,values:[r(this).data("filter-value")]};else for(var s in d[a].values)d[a].values[s]==r(this).data("filter-value")&&d[a].values.splice(s,1);i=r.fn.filtersearch.applyFilterList(d,t),v=1,u()})})})};var y=this.renderFilterContainer;u(),g(),y()},r.fn.filtersearch.renderItem=function(r){var e="";return e+="<h2>"+r.name+"</h2>",e+="<p>"+r.description+"</p>",e+="<em>"+r.price+"</em>"},r.fn.filtersearch.sortMethod=function(r){return function(e,t){return e[r]>t[r]?1:e[r]<t[r]?-1:0}},r.fn.filtersearch.renderFilter=function(r){var e="<ul>";for(var t in r){var i="<li>";i+="<strong>"+r[t].label+"</strong>",i+='<ul data-filter-property="'+t+'">';for(var a in r[t].characteristics)i+='<li data-filter-value="'+a+'"><a>'+a+" ("+r[t].characteristics[a]+")</a></li>";i+="</ul>",i+="</li>",e+=i}return e+="</ul>"},r.fn.filtersearch.applyFilterList=function(r,e){var t=[];for(var i in e){var a=e[i],s=!0;for(var l in r){var n=r[l];if("or"==n.logic){if("string"==typeof a[l])-1==n.values.indexOf(a[l])&&(s=!1);else if("object"==typeof a[l]){var o=!1;for(var f in a[l])if(n.values.indexOf(a[l][f])>-1){o=!0;break}o||(s=!1)}}else if("and"==n.logic){if("string"==typeof a[l]){var o=!0;for(var f in n.values)if(n.values[f]!=a.property){o=!1;break}o||(s=!1)}else if("object"==typeof a[l]){var o=!0;for(var f in n.values)-1==a[l].indexOf(n.values[f])&&(o=!1);o||(s=!1)}}else"xor"==n.logic}s&&t.push(a)}return t}}(jQuery);